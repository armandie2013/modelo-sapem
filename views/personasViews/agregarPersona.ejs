<div class="bg-gray-100 min-h-screen py-8 flex justify-center items-start">
  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm border border-gray-300">
    <h1 class="text-2xl text-center text-gray-800 mb-6">Agregar Personal</h1>

    <script>
      const modulosActivos = []; // Como es agregar, no hay permisos cargados aún
    </script>

    <form action="/personas/agregar" method="POST" class="space-y-4">
      <!-- Datos básicos -->
      <div>
        <label class="block text-sm font-medium text-gray-700">Número de Orden</label>
        <input type="number" name="numeroOrden" required class="w-full border px-3 py-2 rounded-lg">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Legajo</label>
        <input type="text" name="legajo" required class="w-full border px-3 py-2 rounded-lg">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Nombre y Apellido</label>
        <input type="text" name="nombreApellido" required class="w-full border px-3 py-2 rounded-lg">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">DNI</label>
        <input type="text" name="dni" required class="w-full border px-3 py-2 rounded-lg">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Cargo</label>
        <input type="text" name="cargo" required class="w-full border px-3 py-2 rounded-lg">
      </div>

      <!-- Módulos permitidos dinámicos -->
      <!-- Permisos por Módulo -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Permisos por Módulo</label>

        <!-- Checkbox Técnica -->
        <div class="mb-3">
          <label class="inline-flex items-center">
            <input type="checkbox" class="modulo-checkbox mr-2" data-modulo="tecnica">
            <span class="text-base font-semibold">Técnica</span>
          </label>
        </div>

        <div id="sub-tecnica" class="space-y-4 ml-auto hidden">
          <!-- Viáticos -->
          <div class="border border-gray-300 p-3 rounded">
            <p class="font-semibold mb-1">Viáticos</p>
            <div class="flex gap-4 flex-wrap">
              <label><input type="checkbox" name="modulosPermitidos[viaticos][ver]" value="true"> Ver</label>
              <label><input type="checkbox" name="modulosPermitidos[viaticos][crear]" value="true"> Crear</label>
              <label><input type="checkbox" name="modulosPermitidos[viaticos][editar]" value="true"> Editar</label>
              <label><input type="checkbox" name="modulosPermitidos[viaticos][eliminar]" value="true"> Eliminar</label>
            </div>
          </div>

          <!-- Stock -->
          <div class="border border-gray-300 p-3 rounded">
            <p class="font-semibold mb-1">Control de Stock</p>
            <div class="flex gap-4 flex-wrap">
              <label><input type="checkbox" name="modulosPermitidos[stock][ver]" value="true"> Ver</label>
              <label><input type="checkbox" name="modulosPermitidos[stock][crear]" value="true"> Crear</label>
              <label><input type="checkbox" name="modulosPermitidos[stock][editar]" value="true"> Editar</label>
              <label><input type="checkbox" name="modulosPermitidos[stock][eliminar]" value="true"> Eliminar</label>
            </div>
          </div>

          <!-- Reclamos -->
          <div class="border border-gray-300 p-3 rounded">
            <p class="font-semibold mb-1">Reclamos Técnicos</p>
            <div class="flex gap-4 flex-wrap">
              <label><input type="checkbox" name="modulosPermitidos[reclamos][ver]" value="true"> Ver</label>
              <label><input type="checkbox" name="modulosPermitidos[reclamos][crear]" value="true"> Crear</label>
              <label><input type="checkbox" name="modulosPermitidos[reclamos][editar]" value="true"> Editar</label>
              <label><input type="checkbox" name="modulosPermitidos[reclamos][eliminar]" value="true"> Eliminar</label>
            </div>
          </div>
        </div>

        <!-- Checkbox Proyectos -->
        <div class="mb-3 mt-3">
          <label class="inline-flex items-center">
            <input type="checkbox" class="modulo-checkbox mr-2" data-modulo="proyectos">
            <span class="text-base font-semibold">Proyectos</span>
          </label>
        </div>

        <div id="sub-proyectos" class="space-y-4 ml-auto hidden">
          <div class="border border-gray-300 p-3 rounded">
            <p class="font-semibold mb-1">Escuelas</p>
            <div class="flex gap-4 flex-wrap">
              <label><input type="checkbox" name="modulosPermitidos[escuelas][ver]" value="true"> Ver</label>
              <label><input type="checkbox" name="modulosPermitidos[escuelas][crear]" value="true"> Crear</label>
              <label><input type="checkbox" name="modulosPermitidos[escuelas][editar]" value="true"> Editar</label>
              <label><input type="checkbox" name="modulosPermitidos[escuelas][eliminar]" value="true"> Eliminar</label>
            </div>
          </div>
        </div>




        <!-- Botón -->
        <div class="pt-4">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition">
            Agregar Personal
          </button>
        </div>
    </form>
  </div>
</div>



<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modulos = document.querySelectorAll('.modulo-checkbox');

    modulos.forEach((checkbox) => {
      const modulo = checkbox.dataset.modulo;
      const submodulo = document.getElementById(`sub-${modulo}`);

      // Mostrar si algún checkbox interno ya está tildado
      const algunCheckInternoMarcado = submodulo.querySelectorAll('input[type="checkbox"]:checked').length > 0;
      if (algunCheckInternoMarcado) {
        checkbox.checked = true;
        submodulo.classList.remove('hidden');
      }

      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          submodulo.classList.remove('hidden');
        } else {
          // Solo ocultar si no hay ninguno marcado
          const algunoMarcado = [...submodulo.querySelectorAll('input[type="checkbox"]')].some(i => i.checked);
          if (!algunoMarcado) {
            submodulo.classList.add('hidden');
          }
        }
      });
    });
  });
</script>