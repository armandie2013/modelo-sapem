<div class="min-h-[calc(100vh-240px)] px-2 sm:px-4 py-0 sm:py-5 safe-bottom">
  <div class="mx-auto max-w-6xl">

    <div class="bg-white border border-gray-200 rounded-2xl shadow-xl overflow-hidden">
      <!-- Header -->
      <div class="px-6 sm:px-8 py-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 via-white to-white">
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div class="min-w-0">
            <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight text-gray-900">
              Usuarios Registrados
            </h1>
            <p class="mt-1 text-sm text-gray-600">
              Total:
              <span class="font-semibold text-gray-900">
                <%= (usuarios || []).length %>
              </span>
            </p>
          </div>

          <!-- Buscador -->
          <div class="flex flex-col sm:flex-row gap-2 sm:items-center">
            <div class="relative w-full sm:w-[360px]">
              <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414l-3.387-3.387zM14 8a6 6 0 11-12 0 6 6 0 0112 0z"
                    clip-rule="evenodd" />
                </svg>
              </span>

              <input
                id="q-usuarios"
                type="text"
                placeholder="Buscar por nombre, email, DNI o rol…"
                class="w-full rounded-xl border border-gray-300 bg-white px-9 py-2 text-sm text-gray-900 placeholder:text-gray-400
                       focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla -->
      <div class="px-6 sm:px-8 pb-6 pt-4">
        <div class="overflow-hidden rounded-2xl border border-gray-200">
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead class="bg-gray-50 text-left text-gray-700">
                <tr>
                  <!-- Nombre un poco más controlado -->
                  <th class="px-4 py-3 font-semibold w-[260px]">Nombre</th>

                  <!-- ✅ Apellido con ancho real fijo -->
                  <th class="px-4 py-3 font-semibold w-[200px]">Apellido</th>

                  <th class="px-4 py-3 font-semibold min-w-[240px]">Email</th>
                  <th class="px-4 py-3 font-semibold w-[140px]">DNI</th>
                  <th class="px-4 py-3 font-semibold w-[110px]">Rol</th>
                  <th class="px-4 py-3 font-semibold text-right w-[200px]">Acciones</th>
                </tr>
              </thead>

              <tbody class="divide-y divide-gray-100 bg-white">
                <% if (!usuarios || usuarios.length === 0) { %>
                  <tr>
                    <td colspan="6" class="px-4 py-10 text-center text-gray-600">
                      No hay usuarios registrados.
                    </td>
                  </tr>
                <% } else { %>

                  <% usuarios.forEach((u) => { %>
                    <tr
                      class="usuario-row hover:bg-gray-50 transition"
                      data-search="<%= `${u.nombre||''} ${u.apellido||''} ${u.email||''} ${u.dni||''} ${u.rol||''}`.toLowerCase() %>"
                    >
                      <!-- Nombre -->
                      <td class="px-4 py-3 text-gray-900">
                        <div class="flex items-center gap-3">
                          <div
                            class="h-9 w-9 rounded-xl bg-blue-50 border border-blue-100 grid place-items-center text-blue-700 font-bold shrink-0">
                            <%= (u.nombre || '?').trim().slice(0,1).toUpperCase() %>
                          </div>

                          <div class="min-w-0">
                            <div class="font-semibold truncate">
                              <%= u.nombre || '—' %>
                            </div>

                            <!-- ID nunca se parte -->
                            <div class="text-xs text-gray-500 whitespace-nowrap">
                              ID:
                              <span class="font-mono tracking-tight">
                                <%= u._id %>
                              </span>
                            </div>
                          </div>
                        </div>
                      </td>

                      <!-- Apellido -->
                      <td class="px-4 py-3 text-gray-900">
                        <span class="font-medium whitespace-nowrap">
                          <%= u.apellido || '—' %>
                        </span>
                      </td>

                      <!-- Email -->
                      <td class="px-4 py-3 text-gray-900">
                        <span class="block truncate">
                          <%= u.email || '—' %>
                        </span>
                      </td>

                      <!-- DNI -->
                      <td class="px-4 py-3 text-gray-900">
                        <span class="font-mono whitespace-nowrap">
                          <%= u.dni || '—' %>
                        </span>
                      </td>

                      <!-- Rol -->
                      <td class="px-4 py-3 text-gray-900">
                        <span
                          class="inline-flex items-center rounded-full bg-gray-100 border border-gray-200 px-2.5 py-1 text-xs whitespace-nowrap">
                          <%= u.rol || '—' %>
                        </span>
                      </td>

                      <!-- Acciones -->
                      <td class="px-4 py-3">
                        <div class="flex justify-end items-center gap-2">
                          <form
                            action="/usuarios/eliminar/<%= u._id %>?_method=DELETE"
                            method="POST"
                            onsubmit="return confirm('¿Eliminar este usuario?')"
                          >
                            <button
                              type="submit"
                              class="inline-flex items-center gap-2 rounded-xl bg-red-50 border border-red-200 px-3 py-1.5 text-xs font-semibold text-red-700
                                     hover:bg-red-100 transition">
                              Eliminar
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                  <% }) %>

                <% } %>
              </tbody>
            </table>
          </div>
        </div>

        <p class="mt-3 text-xs text-gray-500">
          Tip: podés buscar por nombre, apellido, email, DNI o rol.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const input = document.getElementById('q-usuarios');
    if (!input) return;

    const rows = Array.from(document.querySelectorAll('tr.usuario-row'));
    input.addEventListener('input', () => {
      const q = (input.value || '').toLowerCase().trim();
      rows.forEach((tr) => {
        const hay = tr.dataset.search || '';
        tr.style.display = (!q || hay.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>
