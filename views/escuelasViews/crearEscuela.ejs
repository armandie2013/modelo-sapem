<div class="min-h-[calc(100vh-240px)] px-2 sm:px-4 py-2 sm:py-4 safe-bottom">
  <div class="mx-auto max-w-5xl">

    <div class="bg-white border border-gray-200 rounded-2xl shadow-xl overflow-hidden">
      <!-- Header -->
      <div class="px-4 sm:px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 via-white to-white">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">

          <div class="min-w-0">
            <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight text-gray-900">
              Registrar Nuevo Caso
            </h1>
            <p class="mt-0.5 text-xs sm:text-sm text-gray-600">
              Cargá los datos del caso técnico.
            </p>
          </div>

          <!-- Botón Volver -->
          <div>
            <a
              href="/escuelas/dashboard"
              class="inline-flex items-center justify-center rounded-xl bg-gray-100 border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700
                     hover:bg-gray-200 transition focus:outline-none focus:ring-2 focus:ring-blue-500/30"
            >
              Volver
            </a>
          </div>

        </div>
      </div>

      <div class="px-4 sm:px-6 py-4">

        <% if (typeof errores !=='undefined' && errores.length> 0) { %>
          <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-xl mb-4 shadow-sm">
            <h2 class="font-semibold mb-1 text-sm">Por favor corregí los siguientes errores:</h2>
            <ul class="list-disc pl-5 text-xs sm:text-sm space-y-0.5">
              <% errores.forEach(error=> { %>
                <li><%= error.msg %></li>
              <% }) %>
            </ul>
          </div>
        <% } %>

        <form action="/escuelas/crear" method="POST" class="space-y-4">

          <% const inputBase = "w-full rounded-xl border bg-white px-3 py-1.5 text-sm text-gray-900 transition " +
                               "border-blue-200 hover:border-blue-400 " +
                               "focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500"; %>

          <% const inputMain = "w-full rounded-xl border bg-white px-3 py-1.5 text-sm text-gray-900 transition " +
                               "border-blue-300 hover:border-blue-500 " +
                               "focus:outline-none focus:ring-2 focus:ring-blue-500/25 focus:border-blue-600"; %>

          <% const inputReadonly = "w-full rounded-xl border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm text-gray-700"; %>

          <!-- ===== SECCIÓN 1: Identificación del caso ===== -->
          <section class="rounded-2xl border border-gray-200 bg-gray-50/60 p-4">
            <div class="flex items-center justify-between mb-3">
              <div>
                <h2 class="text-sm font-extrabold text-gray-900">Identificación del caso</h2>
                <p class="text-xs text-gray-600">Datos base para registrar el reclamo.</p>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
              <!-- Ticket -->
              <div class="md:col-span-2">
                <label class="block text-xs font-medium text-gray-700 mb-1">Ticket</label>
                <input
                  type="text"
                  value=""
                  readonly
                  placeholder="Automático"
                  class="<%= inputReadonly %>"
                />
              </div>

              <!-- Fecha -->
              <div class="md:col-span-2">
                <label for="fechaDeCreacion" class="block text-xs font-medium text-gray-700 mb-1">Fecha</label>
                <input
                  type="date"
                  id="fechaDeCreacion"
                  name="fechaDeCreacion"
                  value="<%= datos?.fechaDeCreacion || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>

              <!-- Predio (max 6) -->
              <div class="md:col-span-4">
                <label for="predio" class="block text-xs font-medium text-gray-700 mb-1">Predio</label>
                <input
                  type="text"
                  id="predio"
                  name="predio"
                  value="<%= datos?.predio || '' %>"
                  required
                  inputmode="numeric"
                  maxlength="6"
                  class="<%= inputMain %>"
                />
                <p class="mt-1 text-[11px] text-gray-500">Máximo 6 dígitos.</p>
              </div>

              <!-- CUE (max 9) -->
              <div class="md:col-span-4">
                <label for="cue" class="block text-xs font-medium text-gray-700 mb-1">CUE</label>
                <input
                  type="text"
                  id="cue"
                  name="cue"
                  value="<%= datos?.cue || '' %>"
                  required
                  inputmode="numeric"
                  maxlength="9"
                  class="<%= inputMain %>"
                />
                <p class="mt-1 text-[11px] text-gray-500">Máximo 9 dígitos.</p>
              </div>
            </div>
          </section>

          <!-- ===== SECCIÓN 2: Ubicación ===== -->
          <section class="rounded-2xl border border-gray-200 bg-white p-4">
            <div class="mb-3">
              <h2 class="text-sm font-extrabold text-gray-900">Ubicación</h2>
              <p class="text-xs text-gray-600">Provincia, departamento y ciudad.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
              <div class="md:col-span-4">
                <label for="provincia" class="block text-xs font-medium text-gray-700 mb-1">Provincia</label>
                <input
                  type="text"
                  id="provincia"
                  name="provincia"
                  value="<%= datos?.provincia || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>

              <div class="md:col-span-4">
                <label for="departamento" class="block text-xs font-medium text-gray-700 mb-1">Departamento</label>
                <input
                  type="text"
                  id="departamento"
                  name="departamento"
                  value="<%= datos?.departamento || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>

              <div class="md:col-span-4">
                <label for="ciudad" class="block text-xs font-medium text-gray-700 mb-1">Ciudad</label>
                <input
                  type="text"
                  id="ciudad"
                  name="ciudad"
                  value="<%= datos?.ciudad || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>
            </div>
          </section>

          <!-- ===== SECCIÓN 3: Datos de la escuela ===== -->
          <section class="rounded-2xl border border-gray-200 bg-white p-4">
            <div class="mb-3">
              <h2 class="text-sm font-extrabold text-gray-900">Datos de la escuela</h2>
              <p class="text-xs text-gray-600">Nombre, dirección y proveedor.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
              <div class="md:col-span-6">
                <label for="nombre" class="block text-xs font-medium text-gray-700 mb-1">Nombre de la escuela</label>
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  value="<%= datos?.nombre || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>

              <div class="md:col-span-6">
                <label for="direccion" class="block text-xs font-medium text-gray-700 mb-1">Dirección</label>
                <input
                  type="text"
                  id="direccion"
                  name="direccion"
                  value="<%= datos?.direccion || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>

              <div class="md:col-span-12">
                <label for="proveedor" class="block text-xs font-medium text-gray-700 mb-1">Proveedor</label>
                <input
                  type="text"
                  id="proveedor"
                  name="proveedor"
                  value="<%= datos?.proveedor || '' %>"
                  required
                  class="<%= inputMain %>"
                />
              </div>
            </div>
          </section>

          <!-- ===== SECCIÓN 4: Descripción ===== -->
          <section class="rounded-2xl border border-gray-200 bg-white p-4">
            <div class="mb-3">
              <h2 class="text-sm font-extrabold text-gray-900">Descripción del caso</h2>
              <p class="text-xs text-gray-600">Detalle técnico del reclamo.</p>
            </div>

            <div>
              <label for="detalleDelCaso" class="block text-xs font-medium text-gray-700 mb-1">Detalle del caso</label>
              <textarea
                id="detalleDelCaso"
                name="detalleDelCaso"
                rows="6"
                required
                class="w-full rounded-xl border bg-white px-3 py-3 text-sm text-gray-900 transition
                       border-blue-300 hover:border-blue-500
                       focus:outline-none focus:ring-2 focus:ring-blue-500/25 focus:border-blue-600 resize-y"
              ><%= datos?.detalleDelCaso || '' %></textarea>
            </div>
          </section>

          <div class="flex justify-end pt-3 border-t border-gray-200">
            <button
              type="submit"
              class="inline-flex items-center justify-center rounded-xl bg-blue-600 px-5 py-2 text-sm font-semibold text-white
                     hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-500/30"
            >
              Guardar Reclamo
            </button>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>

<script>
  // Números + límite de dígitos (predio=6, cue=9)
  const limites = { predio: 6, cue: 9 };

  Object.keys(limites).forEach((id) => {
    const input = document.getElementById(id);
    if (!input) return;

    input.addEventListener("input", () => {
      const max = limites[id];
      // deja solo dígitos y recorta al máximo permitido
      input.value = input.value.replace(/\D/g, "").slice(0, max);
    });
  });

  function capitalizarCadaPalabra(texto) {
    return texto.toLowerCase().replace(/\b\w/g, (l) => l.toUpperCase());
  }

  function capitalizarPrimeraLetra(texto) {
    const limpio = texto.trim();
    if (!limpio) return "";
    return limpio.charAt(0).toUpperCase() + limpio.slice(1).toLowerCase();
  }

  const camposTitulo = ["nombre", "provincia", "departamento", "ciudad", "direccion", "proveedor"];

  camposTitulo.forEach((id) => {
    const campo = document.getElementById(id);
    if (campo) {
      campo.addEventListener("blur", () => {
        campo.value = capitalizarCadaPalabra(campo.value);
      });
    }
  });

  const detalle = document.getElementById("detalleDelCaso");
  if (detalle) {
    detalle.addEventListener("blur", () => {
      detalle.value = capitalizarPrimeraLetra(detalle.value);
    });
  }
</script>
