<!-- Scripts existentes de cálculo -->
<script>
  function convertirAFloat(valor) {
    return parseFloat(valor.replace(/\./g, '').replace(',', '.')) || 0;
  }

  function formatArg(num) {
    return num.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  function calcularTotalViatico() {
    let total = 0;
    for (let i = 0; i < 5; i++) {
      const input = document.getElementById(`importeViatico-${i}`);
      if (input && !input.disabled) {
        total +=convertirAFloat(input.value);
      }
    }
    document.getElementById('totalViatico').innerText = formatArg(total);
    calcularTotalARecibir();
  }

  function calcularTotalARecibir() {
    const viatico = convertirAFloat(document.getElementById("totalViatico")?.innerText || "0");
    const adicional = convertirAFloat(document.getElementById("adicionalEnEfectivo")?.value || "0");
    document.getElementById("totalARecibir").innerText = formatArg(viatico + adicional);
  }

  function calcularPendiente() {
    const adicional = convertirAFloat(document.getElementById('adicionalEnEfectivo')?.value || "0");
    const rendido = convertirAFloat(document.getElementById('rendido')?.value || "0");
    const pendiente = adicional - rendido;
    document.getElementById('pendienteDeRendicion').value = formatArg(pendiente < 0 ? 0 : pendiente);
  }

  function calcularTotalVales() {
    const cantidad = parseInt(document.getElementById("cantidadVale")?.value || 0);
    const valor = convertirAFloat(document.getElementById("valorVale")?.value || "0");
    const total = cantidad * valor;
    document.getElementById("totalVale").value = formatArg(total);
  }

  document.querySelectorAll('.importe').forEach(input => {
    input.addEventListener('input', calcularTotalViatico);
  });

  document.getElementById("adicionalEnEfectivo")?.addEventListener("input", () => {
    calcularPendiente();
    calcularTotalARecibir();
  });

  document.getElementById("rendido")?.addEventListener("input", calcularPendiente);

  document.getElementById("valesCombustible")?.addEventListener("change", function () {
    const campos = document.getElementById("camposVales");
    campos.style.display = this.checked ? "grid" : "none";
  });

  document.getElementById("valorVale")?.addEventListener("input", calcularTotalVales);
  document.getElementById("cantidadVale")?.addEventListener("input", calcularTotalVales);

  document.getElementById("cantidadDeViajantes").addEventListener("change", function () {
    const cantidad = parseInt(this.value);
    for (let i = 0; i < 5; i++) {
      const select = document.getElementById(`viajante-${i}`);
      select.disabled = i >= cantidad;
      select.classList.toggle("bg-gray-100", i >= cantidad);
      if (i >= cantidad) select.selectedIndex = 0;
    }
  });
// Ingresa el automaticamente el cargo segun se selecione las personas
  document.querySelectorAll('.viajante-select').forEach(select => {
    select.addEventListener('change', function () {
      const index = this.dataset.index;
      const selected = this.options[this.selectedIndex];
      const cargo = selected.getAttribute('data-cargo') || '';
      document.getElementById(`cargo-${index}`).value = cargo;
    });
  });

  document.getElementById("cantidadDeViajantes").dispatchEvent(new Event("change"));

</script>

<!-- Script para enviar totales ocultos -->
<script>
  function convertirAFloat(valor) {
    return parseFloat(valor.replace(/\./g, '').replace(',', '.')) || 0;
  }

  document.querySelector("form").addEventListener("submit", function () {
    document.getElementById("montoTotalViaticoHidden").value = convertirAFloat(document.getElementById("totalViatico").innerText);
    document.getElementById("pendienteDeRendicionHidden").value = convertirAFloat(document.getElementById("pendienteDeRendicion").value);
  });

  /// Habilitar campos según cantidad de viajantes
  function actualizarCamposViajantes() {
    const cantidad = parseInt(document.getElementById("cantidadDeViajantes").value);
    const selects = document.querySelectorAll(".viajante-select");
    const importes = document.querySelectorAll(".importe");

    selects.forEach((select, i) => {
      select.disabled = i >= cantidad;
      select.classList.toggle("bg-gray-100", i >= cantidad);
      if (i >= cantidad) select.value = "";
    });

    importes.forEach((input, i) => {
      input.disabled = i >= cantidad;
      input.classList.toggle("bg-gray-100", i >= cantidad);
      if (i >= cantidad) input.value = "";
    });
  }

  document.getElementById("cantidadDeViajantes").addEventListener("change", actualizarCamposViajantes);

  // Ejecutar una vez al inicio para asegurar el estado correcto
  window.addEventListener("DOMContentLoaded", actualizarCamposViajantes);

  // Validar que solo se ingresen números en los campos de importe
  document.querySelectorAll(".importe").forEach(input => {
    input.addEventListener("input", function (e) {
      this.value = this.value.replace(/[^0-9.,]/g, "");
    });
  });

  // Evitar selección duplicada de viajantes
  document.querySelectorAll('.viajante-select').forEach(select => {
    select.addEventListener('change', function () {
      const selectedValues = Array.from(document.querySelectorAll('.viajante-select'))
        .map(s => s.value)
        .filter(v => v);

      const duplicates = selectedValues.filter((v, i, a) => a.indexOf(v) !== i);

      if (duplicates.length > 0) {
        alert('No se pueden seleccionar viajantes duplicados.');
        this.value = "";
      }
    });
  });
  
  


  
</script>