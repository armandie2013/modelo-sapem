<main class="bg-gray-100 min-h-screen py-10 px-4">
  <%
    // Helper USD: US$ 12.345,67 (locale es-AR)
    const fmtUSD = (v) =>
      new Intl.NumberFormat('es-AR', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(Number(v || 0));
  %>

  <div class="max-w-6xl mx-auto space-y-6">

    <!-- Header + acciones -->
    <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-300">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">
            Proveedor #<%= proveedor.numeroProveedor %> — <%= proveedor.nombreFantasia || proveedor.nombreReal %>
          </h1>
          <h1 class="text-xl font-bold text-gray-900">
            Nombre: <%= proveedor.nombreReal %>
          </h1>
          <p class="text-sm text-gray-600">
            CUIT: <span class="font-mono"><%= proveedor.cuit || '—' %></span> ·
            IVA: <%= proveedor.condicionIva || '—' %> ·
            Tel: <%= proveedor.telefonoCelular || '—' %> ·
            Estado:
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium <%= (proveedor.activo ?? true) ? 'bg-green-100 text-green-800' : 'bg-gray-200 text-gray-700' %>">
              <%= (proveedor.activo ?? true) ? 'Activo' : 'Inactivo' %>
            </span>
          </p>

          <p class="text-sm text-gray-600 mt-1">
            Plan:
            <% if (proveedor.plan) { %>
              <span class="font-medium"><%= proveedor.plan.nombre %></span>
              — <%= fmtUSD(proveedor.plan.importe || proveedor.precioPlan || 0) %>
              <% if (typeof proveedor.precioPlan === 'number') { %>
                <span class="text-xs text-gray-500">(override)</span>
              <% } %>
            <% } else { %>
              <span class="text-gray-500">Sin plan</span>
            <% } %>
          </p>

          <!-- <p class="text-sm text-gray-600">
            Período: <span class="font-semibold"><%= periodo %></span>
          </p> -->
        </div>

        <div class="flex flex-wrap gap-2">
          <a href="/pagos/proveedores/<%= proveedor._id %>/registrar?periodo=<%= periodo %>"
             class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-800 transition text-sm">
            + Registrar pago
          </a>

          <a href="/notas/proveedores/<%= proveedor._id %>/credito?periodo=<%= periodo %>"
             class="bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition text-sm">
            + Nota de crédito
          </a>
          <a href="/notas/proveedores/<%= proveedor._id %>/debito?periodo=<%= periodo %>"
             class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition text-sm">
            + Nota de débito
          </a>

          <a href="/proveedores/<%= proveedor._id %>/ver"
             class="bg-gray-100 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-200 text-sm">
            ← Volver
          </a>
        </div>
      </div>
    </div>

    <!-- Resumen del período -->
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
      <div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-300">
        <p class="text-xs text-gray-500">Total cargos</p>
        <p class="text-xl font-semibold"><%= fmtUSD(totales.cargo) %></p>
      </div>
      <div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-300">
        <p class="text-xs text-gray-500">Notas de débito</p>
        <p class="text-xl font-semibold"><%= fmtUSD(totales.notaDebito) %></p>
      </div>
      <div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-300">
        <p class="text-xs text-gray-500">Notas de crédito</p>
        <p class="text-xl font-semibold"><%= fmtUSD(totales.notaCredito) %></p>
      </div>
      <div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-300">
        <p class="text-xs text-gray-500">Pagos</p>
        <p class="text-xl font-semibold"><%= fmtUSD(totales.pagos) %></p>
      </div>
      <div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-300">
        <p class="text-xs text-gray-500">Saldo total</p>
        <p class="text-xl font-semibold <%= totales.saldo > 0 ? 'text-red-600' : (totales.saldo < 0 ? 'text-green-700' : 'text-gray-900') %>">
          <%= fmtUSD(totales.saldo) %>
        </p>
      </div>
    </div>

    <!-- Movimientos del período -->
    <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-300">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2">
        <h2 class="text-lg font-semibold text-gray-800">Movimientos del período</h2>
        <span class="text-sm text-gray-600">
          <span class="hidden sm:inline">Período: </span>
          <span class="inline-flex items-center rounded-full border border-gray-300 bg-gray-50 px-3 py-1 font-medium">
            <%= periodo %>
          </span>
        </span>
      </div>

      <% if ((movimientos || []).length === 0) { %>
        <p class="text-gray-500 text-sm">No hay movimientos en este período.</p>
      <% } else { %>
        <ul class="space-y-3">
          <% movimientos.forEach(m => { %>
            <li class="flex items-start justify-between gap-3 border-b pb-3">
              <div>
                <div class="text-sm">
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                    <%= m.tipo === 'cargo'
                        ? 'bg-sky-100 text-sky-800'
                        : (m.tipo === 'pago'
                            ? 'bg-green-100 text-green-800'
                            : (m.tipo === 'credito'
                                ? 'bg-emerald-100 text-emerald-800'
                                : 'bg-amber-100 text-amber-800')) %>">
                    <%= m.tipo %>
                  </span>
                  <span class="ml-2 font-medium"><%= m.concepto || '(Sin detalle)' %></span>
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  <%= new Date(m.fecha).toLocaleString('es-AR') %>
                  <% if (m.creadorNombre && m.creadorNombre !== '—') { %>
                    · Cargado por <%= m.creadorNombre %>
                  <% } %>
                  <% if (m.tipo === 'pago' && (m.metodo || m.comprobante)) { %>
                    · <%= (m.metodo || '') %> <%= (m.comprobante ? `#${m.comprobante}` : '') %>
                  <% } %>
                </div>
              </div>
              <div class="text-right text-sm font-semibold <%= m.signo > 0 ? 'text-red-600' : 'text-green-700' %>">
                <%= m.signo > 0 ? '+ ' : '- ' %><%= fmtUSD(m.importe) %>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>

  </div>
</main>