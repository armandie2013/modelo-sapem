<main class="bg-gray-100 min-h-screen py-10 px-4">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow-lg border border-gray-300 space-y-6">

    <!-- Avisos -->
    <% if (typeof mensaje !== 'undefined' && mensaje) { %>
      <div class="bg-emerald-50 border border-emerald-200 text-emerald-800 px-4 py-3 rounded-lg">
        <%= mensaje %>
      </div>
    <% } %>
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
        <%= error %>
      </div>
    <% } %>

    <!-- Header -->
    <div class="flex items-start justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Tareas programadas · Cargos mensuales</h1>
        <p class="text-sm text-gray-600">Acá podés ver la próxima ejecución automática y, si tenés permisos, ejecutarla manualmente.</p>
      </div>
      <a href="/" class="text-sm bg-gray-100 px-3 py-2 rounded-lg hover:bg-gray-200 transition">← Inicio</a>
    </div>

    <!-- Info -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white border border-gray-200 rounded-xl p-4">
        <p class="text-xs text-gray-500">Hoy</p>
        <p class="text-lg font-semibold">
          <%= new Intl.DateTimeFormat('es-AR', { dateStyle: 'full', timeStyle: 'short' }).format(hoy) %>
        </p>
      </div>
      <div class="bg-white border border-gray-200 rounded-xl p-4">
        <p class="text-xs text-gray-500">Próxima ejecución programada</p>
        <p class="text-lg font-semibold">
          <%= new Intl.DateTimeFormat('es-AR', { dateStyle: 'full', timeStyle: 'short' }).format(proxima) %>
        </p>
        <p class="text-[11px] text-gray-500 mt-1">Se ejecuta automáticamente el 28 de cada mes a las 03:00.</p>
      </div>
      <div class="bg-white border border-gray-200 rounded-xl p-4">
        <p class="text-xs text-gray-500">Último período con cargos</p>
        <p class="text-lg font-semibold"><%= ultimaPeriodo || '—' %></p>
        <p class="text-[11px] text-gray-500 mt-1">Detectado desde los movimientos de tipo “cargo”.</p>
      </div>
    </div>

    <!-- Acción -->
    <% if (puedeGenerar) { %>
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <h2 class="text-sm font-semibold text-blue-800 mb-2">Generar cargos manualmente</h2>
        <p class="text-xs text-blue-700">
          Esto ejecuta exactamente lo mismo que la tarea del 28 de cada mes. No interfiere con la ejecución programada.
        </p>

        <form action="/cargos/mensual" method="POST" class="mt-3"
              onsubmit="return confirm('¿Generar cargos del período actual? Si ya existen, la operación es idempotente.');">
          <button type="submit"
                  class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
            Generar ahora
          </button>
        </form>
      </div>
    <% } else { %>
      <div class="bg-gray-50 border border-gray-200 rounded-xl p-4">
        <p class="text-sm text-gray-700">
          No tenés permisos para ejecutar esta tarea manualmente.
        </p>
      </div>
    <% } %>
  </div>
</main>
